<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Андрей Акиньшин">
    <meta name="description" content="Учимся округлять в C#">
    <meta name="keywords" content='.NET,C#,Rounding,CheatSheet'>
    <title>Учимся округлять в C#</title>
    <link href='/img/favicon.ico' rel='icon' type='image/x-icon'/>
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/bootstrap-theme.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/about.css" rel="stylesheet" type="text/css" media="all">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    <!-- atom & rss feed -->
    <link href="/ru/rss.xml" type="application/rss+xml" rel="alternate" title="Blog RSS Feed" />
    <link href="/ru/atom.xml" type="application/atom+xml" rel="alternate" title="Blog ATOM Feed" />
    <script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-41419012-5', 'auto');
      ga('send', 'pageview');
    </script>
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
    (function (d, w, c) {
        (w[c] = w[c] || []).push(function() {
            try {
                w.yaCounter28700916 = new Ya.Metrika({id:28700916,
                        clickmap:true,
                        trackLinks:true,
                        accurateTrackBounce:true});
            } catch(e) { }
        });
        var n = d.getElementsByTagName("script")[0],
            s = d.createElement("script"),
            f = function () { n.parentNode.insertBefore(s, n); };
        s.type = "text/javascript";
        s.async = true;
        s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";
        if (w.opera == "[object Opera]") {
            d.addEventListener("DOMContentLoaded", f, false);
        } else { f(); }
    })(document, window, "yandex_metrika_callbacks");
    </script>
    <!-- /Yandex.Metrika counter -->
  </head>
  <body data-spy="scroll" data-offset="80">
    <div id="wrap">
      <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="navbar-header">
          <a class="navbar-brand" href="/ru/blog/" style="width:80px">Блог</a>
        </div>
        <div class="collapse navbar-collapse" id="jb-navbar-collapse">
          <ul class="nav navbar-nav">
            <li style="width:100px"><a href="/ru/blog/content/" class="active">Содержание</a></li>
            <li style="width:120px"><a href="/ru/about/" class="active">Об авторе</a></li>
            <li style="width:140px"><a href='/en/blog/dotnet/cheatsheet-rounding/' class="active">English version</a></li>
          </ul>
        </div>
      </nav>
      <div class="container">
        <div class="row">
  <div class="col-xs-12">
    <div class="row">
      <div class="col-md-9">
        <div id="content-div">
          <div class="page-header">
  <h1>Учимся округлять в C#</h1>
</div>

<div class="row post-full">
  <div class="col-xs-12">
    <div class="content">
       <p>А знаете ли вы, что <code>Math.Round(1.5) == Math.Round(2.5) == 2</code>? Можете ли сходу сказать, сколько будет <code>-7%3</code> и <code>7%-3</code>? Помните ли, чем отличаются
<code>Math.Round</code>, <code>Math.Floor</code>, <code>Math.Ceiling</code>, <code>Math.Truncate</code>? А как происходит округление при использовании <code>string.Format</code>? Давайте немного погрузимся в мир округлений и разберёмся с нюансами, которые не для всех могут быть очевидными.<!--more--></p>
<h3>Math.Round</h3>
<p>MSDN:
<a href="http://msdn.microsoft.com/en-us/library/system.math.round.aspx">Round</a></p>
<pre><code class="language-cs">public static decimal Round(decimal value)
public static double Round(double value)
public static decimal Round(decimal value, int digits)
public static double Round(double value, int digits)
public static decimal Round(decimal value, MidpointRounding mode)
public static double Round(double value, MidpointRounding mode)
public static decimal Round(decimal value, int digits, MidpointRounding mode)
public static double Round(double value, int digits, MidpointRounding mode)
</code></pre>
<p><code>Math.Round</code> — это метод округления к ближайшему числу или к ближайшему числу с заданным количеством знаков после запятой. Работает с типами <code>decimal</code> и <code>double</code>, в параметрах можно встретить три вида параметров:</p>
<ul>
<li><code>value</code>: округляемое число</li>
<li><code>digits</code>: количество знаков в дробной части, которые нужно оставить</li>
<li><code>mode</code>: параметр, который определяет в какую сторону округлять число, которое находится ровно посередине между двумя вариантами</li>
</ul>
<p>Параметр <code>mode</code> используется, когда округляемое значение находится ровно посередине между двумя вариантами. Принимает значение из следующего перечисления:</p>
<pre><code class="language-cs">public enum MidpointRounding { AwayFromZero, ToEven}
</code></pre>
<ul>
<li><code>AwayFromZero</code>: округление происходит к тому числу, которое дальше от нуля.</li>
<li><code>ToEven</code>: округление происходит к чётному числу.</li>
</ul>
<p>Обратите внимание, что по умолчанию <code>mode == MidpointRounding.ToEven</code>, поэтому <code>Math.Round(1.5) == Math.Round(2.5) == 2</code>.</p>
<h3>Math.Floor, Math.Ceiling, Math.Truncate</h3>
<p>MSDN:
<a href="http://msdn.microsoft.com/en-us/library/system.math.floor.aspx">Floor</a>,
<a href="http://msdn.microsoft.com/en-us/library/system.math.ceiling.aspx">Ceiling</a>,
<a href="http://msdn.microsoft.com/en-us/library/system.math.truncate.aspx">Truncate</a></p>
<pre><code class="language-cs">public static decimal Floor(decimal value)
public static double Floor(double value)
public static decimal Ceiling(decimal value)
public static double Ceiling(double value)
public static decimal Truncate(decimal value)
public static double Truncate(double value)
</code></pre>
<ul>
<li><code>Math.Floor</code> округляет вниз по направлению к отрицательной бесконечности.</li>
<li><code>Math.Ceiling</code> округляет вверх по направлению к положительной бесконечности.</li>
<li><code>Math.Truncate</code> округляет вниз или вверх по направлению к нулю.</li>
</ul>
<h3>Сводная таблица</h3>
<p>Сориентироваться в методах округления может помочь следующая табличка:</p>
<pre><code>value               | -2.9 | -0.5 | 0.3 | 1.5 | 2.9 |
--------------------+------+------+-----+-----+-----+
Round(ToEven)       |   -3 |    0 |   0 |   2 |   3 |
Round(AwayFromZero) |   -3 |   -1 |   0 |   2 |   3 |
Floor               |   -3 |   -1 |   0 |   1 |   2 |
Ceiling             |   -2 |    0 |   1 |   2 |   3 |
Truncate            |   -2 |    0 |   0 |   1 |   2 |
</code></pre>
<p>Округление проводится в соответствии со стандартом <em>IEEE Standard 754, section 4</em>.</p>
<h3>Целочисленное деление и взятие по модулю</h3>
<p>В C# есть два замечательных оператора над целыми числами: <code>/</code> для целочисленного деления (<a href="http://msdn.microsoft.com/en-us/library/3b1ff23f.aspx">MSDN</a>) и <code>%</code>
для взятия остатка от деления (<a href="http://msdn.microsoft.com/en-us/library/0w4e0fzs.aspx">MSDN</a>). Деление производится по следующим правилам:</p>
<ul>
<li>При целочисленном делении результат всегда округляется по направлению к нулю.</li>
<li>При взятии остатка от деления должно выполняться следующее правило: <code>x % y = x – (x / y) * y</code></li>
</ul>
<p>Также можно пользоваться шпаргалкой:</p>
<pre><code> a |  b | a/b | a%b |
---+----+-----+-----+
 7 |  3 |  2  |  1  |
-7 |  3 | -2  | -1  |
 7 | -3 | -2  |  1  |
-7 | -3 |  2  | -1  |
</code></pre>
<h3>string.Format</h3>
<p>При форматировании чисел в виде строки можно пользоваться функцией <code>string.Format</code> (см. <a href="http://msdn.microsoft.com/en-us/library/dwhawy9k.aspx">Standard Numeric Format Strings</a>, <a href="http://msdn.microsoft.com/en-us/library/0c899ak8.aspx">Custom Numeric Format Strings</a>). Например, для вывода числа с двумя знаками после десятичной точки можно воспользоваться <code>string.Format(&quot;{0:0.00}&quot;, value)</code> или <code>string.Format(&quot;{0:N2}&quot;, value)</code>. Округление происходит по принципу <code>AwayFromZero</code>. Проиллюстрируем правила округления очередной табличкой:</p>
<pre><code>value  | string.Format(&quot;{0:N2}&quot;, value) |
-------+--------------------------------+
-2.006 | -2.01                          |
-2.005 | -2.01                          |
-2.004 | -2.00                          |
 2.004 |  2.00                          |
 2.005 |  2.01                          |
 2.006 |  2.01                          |
</code></pre>
<h3>Задачи</h3>
<p>На приведённую тему есть две задачки в <a href="http://problembook.net">ProblemBook.NET</a>: <a href="http://problembook.net/content/ru/Math/Rounding1-P.html">Rounding1</a>, <a href="http://problembook.net/content/ru/Math/Rounding2-P.html">Rounding2</a>.</p>
    </div>

      Поделиться:
      <a href="https://twitter.com/intent/tweet?text=Учимся округлять в C#&url=http://aakinshin.net/ru/blog/dotnet/cheatsheet-rounding/&via=andrey_akinshin&related=andrey_akinshin" rel="nofollow" target="_blank" title="Share on Twitter"><img class="profile-image" src="/img/icons/twitter.png" alt="" /></a>
      <a href="https://facebook.com/sharer.php?u=http://aakinshin.net/ru/blog/dotnet/cheatsheet-rounding/" rel="nofollow" target="_blank" title="Share on Facebook"><img class="profile-image" src="/img/icons/facebook.png" alt="" /></a>
      <a href="https://plus.google.com/share?url=http://aakinshin.net/ru/blog/dotnet/cheatsheet-rounding/" rel="nofollow" target="_blank" title="Share on Google+"><img class="profile-image" src="/img/icons/google-plus.png" alt="" /></a>
      <a href="http://vk.com/share.php?url=http://aakinshin.net/ru/blog/dotnet/cheatsheet-rounding/" target="_blank" title="Share on VKontakte"><img class="profile-image" src="/img/icons/vk.png" alt="" /></a>
      <hr />
      <div>
        Исходный код поста находится на GitHub:<br />
        <a href="https://github.com/AndreyAkinshin/aakinshin.net/tree/master/_posts/ru/dotnet/cheatsheet-rounding.md">https://github.com/AndreyAkinshin/aakinshin.net/tree/master/_posts/ru/dotnet/cheatsheet-rounding.md</a>
      </div>
      <div>Вклад в пост:&nbsp;&nbsp;<span id="contributors"></span></div>
      <div id="disqus_thread"></div>
      <script type="text/javascript">
          // Disqus
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = 'aakinshinnet-ru'; // required: replace example with your forum shortname
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
          // Contributors
          var repoFileName = "_posts/ru/dotnet/cheatsheet-rounding.md";
          var contributorUrl = "https://api.github.com/repos/AndreyAkinshin/aakinshin.net/commits?path=" + repoFileName;
          $.getJSON(contributorUrl, function(data) {
              var contributorList = $("<span />");
              var contributorSet = {};
              $.each(data, function(index, item) {
                  if(item.author && !contributorSet.hasOwnProperty(item.author.html_url)) {
                      contributorSet[item.author.html_url] = true;
                      var authorImg = $("<img />", {
                          "src": item.author.avatar_url,
                          "title": item.author.login,
                          "width": 32,
                          "height": 32
                      });
                      var authorLink = $("<a />", {
                          "href": item.author.html_url
                      });
                      authorImg.appendTo(authorLink);
                      authorLink.appendTo(contributorList);
                  }
              });
              $("#contributors").fadeOut("fast", function() {
                  $(this).empty().append(contributorList).fadeIn(1000);
              });
          });
      </script>
      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</div>
        </div>
      </div>
      <div class="col-md-3">
        <div id="sidebar-right">
          <b style="font-size:150%">Блог Андрея Акиньшина</b><br />
          <img src="/img/icons/email.png" alt="" /><br />
          <img src="/img/misc/mvp-logo.png" alt="" /><br />
          <b>Профили</b>
          <aside id="sidebar-right-profiles">
            <a href="https://github.com/AndreyAkinshin" title="GitHub">                            <img src="/img/icons/github.png" alt="" /></a>
            <a href="https://twitter.com/andrey_akinshin" title="Twitter">                         <img src="/img/icons/twitter.png" alt="" /></a>
            <a href="http://habrahabr.ru/users/dreamwalker" title="Хабрахабр">                     <img src="/img/icons/habr.png" alt="" /></a>
            <a href="http://stackoverflow.com/users/184842/AndreyAkinshin" title="StackOverflow">  <img src="/img/icons/stackoverflow.png" alt=""></a>
            <a href="http://www.slideshare.net/AndreyAkinshin" title="SlideShare">                 <img src="/img/icons/slideshare.png" alt="" /></a>
            <a href="http://www.linkedin.com/in/AndreyAkinshin" title="LinkedIn">                  <img src="/img/icons/linkedin.png" alt="" /></a>
            <a href="https://plus.google.com/+AndreyAkinshinRu" title="Google+">                   <img src="/img/icons/google-plus.png" alt="" /></a>
          </aside>
          <br />
          <b>Проекты</b>
          <aside>
            <ul>
              <li><a href="http://problembook.net/">Задачник.NET</a></li>
              <li><a href="https://github.com/AndreyAkinshin/Russian-Phd-LaTeX-Dissertation-Template">LaTeX-шабон для диссертации</a></li>
              <li><a href="https://github.com/AndreyAkinshin/BenchmarkDotNet">BenchmarkDotNet</a></li>
            </ul>
          </aside>
          <b>Избранные посты</b>
          <aside>
            <i>.NET</i>
            <ul>
              <li><a href="/ru/blog/dotnet/typehandle/">Вся правда о TypeHandle в .NET</a></li>
              <li><a href="/ru/blog/dotnet/cheatsheet-rounding/">Учимся округлять в C#</a></li>
              <li><a href="/ru/blog/dotnet/closures/">Неочевидности в использовании C#-замыканий</a></li>
              <li><a href="/ru/blog/dotnet/cheatsheet-nullable/">Nullable-арифметика</a></li>
              <li><a href="/ru/blog/dotnet/ms-mcp/">Получение MCP: личный опыт</a></li>
              <li><a href="/ru/blog/dotnet/happy-monday/">Happy Monday!</a></li>
              <li><a href="/ru/blog/dotnet/cultureinfo/">Эти занимательные региональные настройки</a></li>
              <li><a href="/ru/blog/dotnet/arrays-internal-structure/">Внутреннее устройство массивов в .NET</a></li>
              <li><a href="/ru/blog/dotnet/gc-native/">Неожиданное место для сборки мусора в .NET</a></li>
              <li><a href="/ru/blog/dotnet/list-version-side-effect/">Сайд-эффект внутренней реализации List</a></li>
            </ul>
            <i>.NET — JIT</i>
            <ul>
              <li><a href="/ru/blog/dotnet/ryujit-rc-and-constant-folding/">RyuJIT RC и свёртка констант</a></li>
              <li><a href="/ru/blog/dotnet/unrolling-of-small-loops-in-different-jit-versions/">Размотка маленьких циклов в разных версиях JIT</a></li>
              <li><a href="/ru/blog/dotnet/ryujit-ctp5-and-loop-unrolling/">RyuJIT CTP5 и размотка циклов</a></li>
              <li><a href="/ru/blog/dotnet/jit-version-determining-in-runtime/">Определение версии JIT в рантайме</a></li>
              <li><a href="/ru/blog/dotnet/subexpression-elimination-bug-in-jit-x64/">История про баг в JIT-x64</a></li>
              <li><a href="/ru/blog/dotnet/inlining-and-starg/">История про инлайнинг под JIT-x86 и starg</a></li>
            </ul>
            <i>R</i>
            <ul>
              <li><a href="/ru/blog/r/functions/">Функции в R</a></li>
              <li><a href="/ru/blog/r/rprofile/">Rprofile — кастомизируем рабочее окружение</a></li>
              <li><a href="/ru/blog/r/string-concatenation/">Конкатенация строк в R</a></li>
            </ul>
            <i>Разработка</i>
            <ul>
              <li><a href="/ru/blog/dev/perfect-code-and-real-projects/">Совершенный код и реальные проекты</a></li>
              <li><a href="/ru/blog/dev/refactoring/">Рефакторить или не рефакторить?</a></li>
              <li><a href="/ru/blog/dev/comments/">Комментировать или не комментировать?</a></li>
            </ul>
            <i>Образование</i>
            <ul>
              <li><a href="/ru/blog/education/government-decree-842/">Изменения в правилах защиты диссертаций</a></li>
            </ul>
          </aside>
          <b>Подписаться</b>
          <aside>
            <a href="/ru/rss.xml"><i class="icon-connection"></i>RSS</a>&nbsp;
            <a href="/ru/atom.xml"><i class="icon-connection"></i>Atom</a>
          </aside>
        </div>
      </div>
    </div>
  </div>
</div>
      </div>
    </div>
    <div id="footer">
      <div class="container">
        <p>&copy; 2014–2015 Андрей Акиньшин</p>
      </div>
    </div>
    <script>
    $(function() {
      $('a[href*=#]:not([href=#])').click(function() {
        if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
          var target = $(this.hash);
          target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
          if (target.length) {
            $('html,body').animate({
              scrollTop: target.offset().top-70
            }, 1000, 'swing', function () {
             $("a").blur();
            });
            return false;
          }
        }
      });
    });
    $(function() {
       $('table').not(".table-ok").addClass("table");
       $('table').not(".table-ok").addClass("table-bordered");
       // $('table').not(".table-ok").addClass("table-striped");
    });
    (function($, window, undefined) {
      // Add pretty print to all pre and code tags.
      $('pre, code').addClass("prettyprint");
      // Remove prettify from code tags inside pre tags.
      $('pre code').removeClass("prettyprint");
    })(jQuery, this);
    </script>
    <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
  </body>
</html>
