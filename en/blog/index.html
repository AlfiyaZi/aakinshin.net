<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <link href='/img/favicon.ico' rel='icon' type='image/x-icon'/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Andrey Akinshin&#39;s blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/bootstrap-theme.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/about.css" rel="stylesheet" type="text/css" media="all">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    <!-- atom & rss feed -->
    <link href="/en/rss.xml" type="application/rss+xml" rel="alternate" title="Blog RSS Feed" />
    <link href="/en/atom.xml" type="application/atom+xml" rel="alternate" title="Blog ATOM Feed" />
    <script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
  </head>
  <body data-spy="scroll" data-offset="80">
    <div id="wrap">
      <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="navbar-header">
          <a class="navbar-brand" href="/en/blog/" style="width:80px">Blog</a>
        </div>
        <div class="collapse navbar-collapse" id="jb-navbar-collapse">
          <ul class="nav navbar-nav">
            <li style="width:100px"><a href="/en/blog/content/" class="active">Content</a></li>
            <li style="width:120px"><a href="/en/about/" class="active">About author</a></li>
            <li style="width:140px"><a href='/ru/blog/' class="active">Russian version</a></li>
          </ul>
        </div>
      </nav>
      <div class="container">
        <div class="row">
  <div class="col-xs-12">
    <div class="row">
      <div class="col-md-8">
<div class="posts">
        <div class="idea">
            <h2><a href="/en/blog/dotnet/mono-utf8-conversions/index.html">About UTF-8 conversions in Mono</a></h2>
            <p>This post is a logical continuation of the Jon Skeet's blog post <a href="http://codeblog.jonskeet.uk/2014/11/07/when-is-a-string-not-a-string">“When is a string not a string?”</a>. Jon showed very interesting things about behavior of ill-formed Unicode strings in .NET. I wondered about how similar examples will work on Mono. And I have got very interesting results.</p>
<h3>Experiment 1: Compilation</h3>
<p>Let's take the Jon's code with a small modification. We will just add <code>text</code> null check in <code>DumpString</code>:</p>
<pre><code class="language-cs">using System;
using System.ComponentModel;
using System.Text;
using System.Linq;
 
[Description(Value)]
class Test
{
    const string Value = &quot;X\ud800Y&quot;;
 
    static void Main()
    {
        var description = (DescriptionAttribute)typeof(Test).
            GetCustomAttributes(typeof(DescriptionAttribute), true)[0];
        DumpString(&quot;Attribute&quot;, description.Description);
        DumpString(&quot;Constant&quot;, Value);
    }
 
    static void DumpString(string name, string text)
    {
        Console.Write(&quot;{0}: &quot;, name);
        if (text != null)
        {
            var utf16 = text.Select(c =&gt; ((uint) c).ToString(&quot;x4&quot;));
            Console.WriteLine(string.Join(&quot; &quot;, utf16));
        }
        else
            Console.WriteLine(&quot;null&quot;);
    }
}
</code></pre>
</p>
            <a href='/en/blog/dotnet/mono-utf8-conversions/'>Read more</a><br /><br />
            <span class="postdate">
              <b>Date:</b> November 10, 2014. <b>Tags:</b>
                    <span>[</span><span>Encodings</span><span>]</span>
                    <span>[</span><span>.NET</span><span>]</span>
                    <span>[</span><span>Mono</span><span>]</span>
            </span>
            <hr />
        </div>
        <div class="idea">
            <h2><a href="/en/blog/dev/refactoring/index.html">To Refactor Or Not To Refactor?</a></h2>
            <p>I like refactoring. No, I love refactoring. No, not even like this. I awfully love refactoring.</p>
<p>I hate bad code and bad architecture. I feel quite creepy when I design a new feature and the near-by class contains absolute mess. I just can’t look at the sadly-looking variables. Sometimes before falling asleep I close my eyes and imagine what could be improved in the project. Sometimes I wake up at 3:00AM and go to my computer to improve something. I want to have not just code, but a masterpiece that is pleasant to look at, that is pleasant to work with at any stage of the project.</p>
<p>If you just a little bit share my feelings we have something to talk about. The matter is that over some time something inside me began to hint that it’s a bad idea to refactor all code, everywhere and all the time. Understand me correctly – code should be good (even better when it’s ideal), but in real life it’s not reasonable to improve code instantly. I formed some rules about the refactoring timeliness. If I am itching to improve something, I look at these rules and think “Is that the moment when I need to refactor the code?” So, let’s talk about when refactoring is necessary and when it’s inappropriate.</p>
            <a href='/en/blog/dev/refactoring/'>Read more</a><br /><br />
            <span class="postdate">
              <b>Date:</b> July 19, 2014. <b>Tags:</b>
                    <span>[</span><span>PerfectCode</span><span>]</span>
                    <span>[</span><span>Refactoring</span><span>]</span>
            </span>
            <hr />
        </div>
        <div class="idea">
            <h2><a href="/en/blog/dotnet/findelementsinhostcoordinates/index.html">Strange behavior of FindElementsInHostCoordinates in WinRT</a></h2>
            <p>Silverlight features a splendid method: <a href="http://msdn.microsoft.com/en-us/library/system.windows.media.visualtreehelper.findelementsinhostcoordinates(v=vs.95).aspx">VisualTreeHelper.FindElementsInHostCoordinates</a>. It allows the <code>HitTest</code>, i.e. makes it possible for a point or rectangle to search for all visual sub-tree objects that intersect this rectangle or point. Formally the same method <a href="http://msdn.microsoft.com/en-us/library/windows/apps/windows.ui.xaml.media.visualtreehelper.findelementsinhostcoordinates.aspx">VisualTreeHelper.FindElementsInHostCoordinates</a> is available in WinRT. And it seems the method looks in the same way, but there is a little nuance. It works differently in different versions of the platform. So, let’s see what’s going on.</p>
            <a href='/en/blog/dotnet/findelementsinhostcoordinates/'>Read more</a><br /><br />
            <span class="postdate">
              <b>Date:</b> April 29, 2014. <b>Tags:</b>
                    <span>[</span><span>.NET</span><span>]</span>
                    <span>[</span><span>C#</span><span>]</span>
                    <span>[</span><span>Silverlight</span><span>]</span>
                    <span>[</span><span>WinRT</span><span>]</span>
            </span>
            <hr />
        </div>
        <div class="idea">
            <h2><a href="/en/blog/dotnet/system-drawing-color-equals/index.html">About System.Drawing.Color and operator ==</a></h2>
            <p>Operator <code>==</code> that allows easy comparison of your objects is overridden for many standard structures in .NET. Unfortunately, not every developer really knows what is actually compared when working with this wonderful operator. This brief blog post will show the comparison logic based on a sample of <code>System.Drawing.Color</code>. What do you think the following code will get:</p>
<pre><code class="language-cs">var redName = Color.Red;
var redArgb = Color.FromArgb(255, 255, 0, 0);
Console.WriteLine(redName == redArgb);
</code></pre>
</p>
            <a href='/en/blog/dotnet/system-drawing-color-equals/'>Read more</a><br /><br />
            <span class="postdate">
              <b>Date:</b> February 21, 2014. <b>Tags:</b>
                    <span>[</span><span>.NET</span><span>]</span>
                    <span>[</span><span>Colors</span><span>]</span>
                    <span>[</span><span>C#</span><span>]</span>
                    <span>[</span><span>Equals</span><span>]</span>
            </span>
            <hr />
        </div>
        <div class="idea">
            <h2><a href="/en/blog/dotnet/msbuild-configurations/index.html">Setting up build configuration in .NET</a></h2>
            <p>You get two default build configurations: Debug and Release, when creating a new project in Visual Studio. And it’s enough for most small projects. But there can appear a necessity to extend it with the additional configurations. It’s ok if you need to add just a couple of new settings, but what if there are tens of such settings? And what if your solution contains 20 projects that need setting up of these configurations? In this case it becomes quite difficult to manage and modify build parameters.</p>
<p>In this article, we will review a way to make this process simpler by reducing description of the build configurations.</p>
            <a href='/en/blog/dotnet/msbuild-configurations/'>Read more</a><br /><br />
            <span class="postdate">
              <b>Date:</b> February 07, 2014. <b>Tags:</b>
                    <span>[</span><span>.NET</span><span>]</span>
                    <span>[</span><span>MSBuild</span><span>]</span>
                    <span>[</span><span>Configurations</span><span>]</span>
            </span>
            <hr />
        </div>
        <div class="idea">
            <h2><a href="/en/blog/dotnet/jon-skeet-quiz/index.html">Jon Skeet&#39;s Quiz</a></h2>
            <p>Jon Skeet was once asked to give three questions to check how well you know C#. He asked the <a href="http://www.dotnetcurry.com/magazine/jon-skeet-quiz.aspx">following questions</a>:</p>
<ul>
<li><strong>Q1.</strong> <em>What constructor call can you write such that this prints True (at least on the Microsoft .NET implementation)?</em></li>
</ul>
<pre><code class="language-cs">object x = new /* fill in code here */;
object y = new /* fill in code here */;
Console.WriteLine(x == y);
</code></pre>
<p><em>Note that it’s just a constructor call, and you can’t change the type of the variables.</em></p>
<ul>
<li><strong>Q2.</strong> <em>How can you make this code compile such that it calls three different method overloads?</em></li>
</ul>
<pre><code class="language-cs">void Foo()
{
    EvilMethod&lt;string&gt;();
    EvilMethod&lt;int&gt;();
    EvilMethod&lt;int?&gt;();
}
</code></pre>
<ul>
<li><strong>Q3.</strong> <em>With a local variable (so no changing the variable value cunningly), how can you make this code fail on the second line?</em></li>
</ul>
<pre><code class="language-cs">string text = x.ToString(); // No exception
Type type = x.GetType(); // Bang!
</code></pre>
<p>These questions seemed interesting to me, that is why I decided to discuss the solutions.</p>
            <a href='/en/blog/dotnet/jon-skeet-quiz/'>Read more</a><br /><br />
            <span class="postdate">
              <b>Date:</b> November 03, 2013. <b>Tags:</b>
                    <span>[</span><span>.NET</span><span>]</span>
                    <span>[</span><span>C#</span><span>]</span>
            </span>
            <hr />
        </div>
        <div class="idea">
            <h2><a href="/en/blog/dev/perfect-code-and-real-projects/index.html">Perfect code and real projects</a></h2>
            <p>I’ve got a problem. I am a perfectionist. I like perfect code. This is not only the correct way to develop applications but also the real proficiency. I enjoy reading a good listing not less than reading a good book. Developing architecture of a big project is no simpler than designing architecture of a big building. In case the work is good the result is no less beautiful. I am sometimes fascinated by how elegantly the patterns are entwined in the perfect software system. I am delighted by the attention to details when every method is so simple and understandable that can be a classic sample of the perfect code.</p>
            <a href='/en/blog/dev/perfect-code-and-real-projects/'>Read more</a><br /><br />
            <span class="postdate">
              <b>Date:</b> August 27, 2013. <b>Tags:</b>
                    <span>[</span><span>PerfectCode</span><span>]</span>
            </span>
            <hr />
        </div>
        <div class="idea">
            <h2><a href="/en/blog/dev/comments/index.html">To Add Comments or Not to Add?</a></h2>
            <p><em>A really good comment is the one you managed to avoid. (c) Uncle Bob</em></p>
<p>Lately, I’ve been feeling really tired of hot discussions on if it’s necessary to add comments in the code. As a rule, there are self-confident juniors with the indisputable statement as: “Why not to comment it, it will be unreadable without the comments!” on one side. And experienced seniors are on the other side. They understand that if it’s possible to go without the comments than “You better, damn it, do it in this way!” Probably, many developers got comment cravings since they’ve been students when professors made them comment every code line, “to make the student better understand it”. Real projects shouldn’t contain a lot of comments that only spoil the code. I don’t agitate for avoiding comments at all, but if you managed to write the code that doesn’t need comments, you can consider it your small victory. I would like to refer you to some good books that helped form my position. I like and respect these authors and completely share their opinion.</p>
<ul>
<li><a href="http://www.amazon.com/Code-Complete-Practical-Handbook-Construction/dp/0735619670">Steven C. McConnell, Code Complete</a></li>
<li><a href="http://www.amazon.com/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882">Robert Martin, Clean Code: A Handbook of Agile Software Craftsmanship</a></li>
<li><a href="http://www.amazon.com/The-Readable-Code-Theory-Practice/dp/0596802293">Dustin Boswell, Trevor Foucher, The Art of Readable Code (Theory in Practice)</a></li>
</ul>
</p>
            <a href='/en/blog/dev/comments/'>Read more</a><br /><br />
            <span class="postdate">
              <b>Date:</b> August 27, 2013. <b>Tags:</b>
                    <span>[</span><span>PerfectCode</span><span>]</span>
            </span>
            <hr />
        </div>
        <div class="idea">
            <h2><a href="/en/blog/dotnet/gc-native/index.html">Unexpected area to collect garbage in .NET</a></h2>
            <p>The .NET framework provides an intelligent garbage collector that saves us a trouble of manual memory management. And in 95% of cases you can forget about memory and related issues. But the remaining 5% have some specific aspects connected to unmanaged resources, too big objects, etc. And it’s better to know how the garbage is collected. Otherwise, you can get surprises.</p>
<p>Do you think GC is able to collect an object till its last method is complete? It appears it is. But it is necessary to run an application in release mode without debugging. In this case JIT compiler will perform optimizations that will make this situation possible. Of course, JIT compiler does it when the remaining method body doesn’t contain references to the object or its fields. It should seem a very harmless optimization. But it can lead to the problems if you work with the unmanaged resources: object compilation can be executed before the operation over the unmanaged resource is finished. And most likely it will result in the application crash. </p>
            <a href='/en/blog/dotnet/gc-native/'>Read more</a><br /><br />
            <span class="postdate">
              <b>Date:</b> August 08, 2013. <b>Tags:</b>
                    <span>[</span><span>.NET</span><span>]</span>
                    <span>[</span><span>GC</span><span>]</span>
                    <span>[</span><span>OpenCV</span><span>]</span>
            </span>
            <hr />
        </div>
        <div class="idea">
            <h2><a href="/en/blog/dotnet/closures/index.html">Unobviousness in use of C# closures</a></h2>
            <p>C# gives us an ability to use closures. This is a powerful tool that allows anonymous methods and lambda-functions to capture unbound variables in their lexical scope. And many programmers in .NET world like using closures very much, but only few of them understand how they really work. Let’s start with a simple sample:</p>
<pre><code class="language-cs">public void Run()
{
  int e = 1;
  Foo(x =&gt; x + e);
}
</code></pre>
<p>Nothing complicated happens here: we just captured a local variable <code>e</code> in its lambda that is passed to some <code>Foo</code> method. Let’s see how the compiler will expand such construction.*</p>
<pre><code class="language-cs">public void Run()
{
  DisplayClass c = new DisplayClass();
  c.e = 1;  
  Foo(c.Action);
}

private sealed class DisplayClass
{
  public int e;

  public int Action(int x)
  {
    return x + e;
  }
}
</code></pre>
</p>
            <a href='/en/blog/dotnet/closures/'>Read more</a><br /><br />
            <span class="postdate">
              <b>Date:</b> August 07, 2013. <b>Tags:</b>
                    <span>[</span><span>Lambda</span><span>]</span>
                    <span>[</span><span>Closures</span><span>]</span>
                    <span>[</span><span>C#</span><span>]</span>
                    <span>[</span><span>.NET</span><span>]</span>
            </span>
            <hr />
        </div>
        <div class="idea">
            <h2><a href="/en/blog/dotnet/wrap-cs-in-com/index.html">Wrapping C# class for use in COM</a></h2>
            <p>Let us have a C# class that makes something useful, for example:</p>
<pre><code class="language-cs">public class Calculator
{
    public int Sum(int a, int b)
    {
        return a + b;
    }
}
</code></pre>
<p>Let’s create a <a href="http://ru.wikipedia.org/wiki/Component_Object_Model">COM</a> interface for this class to make it possible to use its functionality in other areas. At the end we will see how this class is used in Delphi environment.</p>
            <a href='/en/blog/dotnet/wrap-cs-in-com/'>Read more</a><br /><br />
            <span class="postdate">
              <b>Date:</b> June 03, 2013. <b>Tags:</b>
                    <span>[</span><span>.NET</span><span>]</span>
                    <span>[</span><span>C#</span><span>]</span>
                    <span>[</span><span>COM</span><span>]</span>
            </span>
            <hr />
        </div>
</div>
<hr />
<p style="font-size:200%"><a href="/ru/blog/">More posts in Russian</a></p>
      </div>
      <div class="col-md-4">
        <div style="margin-top: 20px;" id="sidebar-right">
          <b>Profiles</b>
          <aside id="sidebar-right-profiles">
            <a href="https://github.com/AndreyAkinshin" title="GitHub">                            <img src="/img/icons/github.png" alt="" /></a>
            <a href="https://twitter.com/andrey_akinshin" title="Twitter">                         <img src="/img/icons/twitter.png" alt="" /></a>
            <a href="http://habrahabr.ru/users/dreamwalker" title="Habrahabr">                     <img src="/img/icons/habr.png" alt="" /></a>
            <a href="http://stackoverflow.com/users/184842/AndreyAkinshin" title="StackOverflow">  <img src="/img/icons/stackoverflow.png" alt=""></a>
            <a href="https://coderbits.com/Akinshin" title="CoderBits">                            <img src="/img/icons/coderbits.png" alt="" /></a>
            <a href="http://www.goodreads.com/AndreyAkinshin" title="GoodReads">                   <img src="/img/icons/goodreads.png" alt="" /></a>
            <a href="http://www.slideshare.net/AndreyAkinshin" title="SlideShare">                 <img src="/img/icons/slideshare.png" alt="" /></a>
            <a href="http://www.linkedin.com/in/AndreyAkinshin" title="LinkedIn">                  <img src="/img/icons/linkedin.png" alt="" /></a>
            <a href="https://plus.google.com/+AndreyAkinshinRu" title="Google+">                   <img src="/img/icons/google-plus.png" alt="" /></a>
            <a href="https://www.facebook.com/aakinshin.ru" title="Facebook">                      <img src="/img/icons/facebook.png" alt="" /></a>
            <a href="http://acm.timus.ru/author.aspx?id=27570" title="Timus">                      <img src="/img/icons/timus.png" alt="" /></a>
            <a href="https://www.diigo.com/user/AndreyAkinshin" title="Diigo">                     <img src="/img/icons/diigo.png" alt="" /></a>
            <a href="https://www.researchgate.net/profile/Andrey_Akinshin" title="ResearchGate">   <img src="/img/icons/research-gate.png" alt="" /></a>
            <a href="http://www.mendeley.com/profiles/andrey-akinshin/" title="Mendeley">          <img src="/img/icons/mendeley.png" alt="" /></a>
            <a href="http://www.mathnet.ru/php/person.phtml?personid=79053" title="MathNet">       <img src="/img/icons/math-net.png" alt="" /></a>
            <a href="http://elibrary.ru/author_items.asp?authorid=676806" title="elibrary">        <img src="/img/icons/elibrary.png" alt="" /></a>
            <a href="http://scholar.google.ru/citations?user=rYVl83IAAAAJ" title="Google Scholar"> <img src="/img/icons/google-scholar.png" alt="" /></a>
          </aside>
          <br />
          <b>Projects</b>
          <aside>
            <ul>
              <li><a href="http://problembook.net/">ProblemBook.NET</a></li>
              <li><a href="https://github.com/AndreyAkinshin/Russian-Phd-LaTeX-Dissertation-Template">LaTeX-templte for Phd thesis</a></li>
              <li><a href="https://github.com/AndreyAkinshin/BenchmarkDotNet">BenchmarkDotNet</a></li>
            </ul>
          </aside>
          <b>Selected posts</b>
          <aside>
            <i>.NET</i>
            <ul>
              <li><a href="/en/blog/dotnet/mono-utf8-conversions/">About UTF-8 conversions in Mono</a></li>
              <li><a href="/en/blog/dotnet/system-drawing-color-equals/">About System.Drawing.Color and operator ==</a></li>
              <li><a href="/en/blog/dotnet/msbuild-configurations/">Setting up build configuration in .NET</a></li>
              <li><a href="/en/blog/dotnet/jon-skeet-quiz/">Jon Skeet's Quiz</a></li>
              <li><a href="/en/blog/dotnet/gc-native/">Unexpected area to collect garbage in .NET</a></li>
              <li><a href="/en/blog/dotnet/closures/">Unobviousness in use of C# closures</a></li>
              <li><a href="/en/blog/dotnet/wrap-cs-in-com/">Wrapping C# class for use in COM</a></li>
            </ul>
            <i>Development</i>
            <ul>
              <li><a href="/en/blog/dev/refactoring/">To Refactor Or Not To Refactor?</a></li>
              <li><a href="/en/blog/dev/comments/">To Add Comments Or Not To Add?</a></li>
              <li><a href="/en/blog/dev/perfect-code-and-real-projects/">Perfect code and real projects</a></li>
            </ul>
          </aside>
          <b>Subscribe</b>
          <aside>
            <a href="/en/rss.xml"><i class="icon-connection"></i>RSS</a>&nbsp;
            <a href="/en/atom.xml"><i class="icon-connection"></i>Atom</a>
          </aside>
        </div>
      </div>
    </div>
  </div>
</div>
      </div>
    </div>
    <div id="footer">
      <div class="container">
        <p>&copy; 2014–2015 Andrey Akinshin</p>
      </div>
    </div>
    <script>
    $(function() {
      $('a[href*=#]:not([href=#])').click(function() {
        if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
          var target = $(this.hash);
          target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
          if (target.length) {
            $('html,body').animate({
              scrollTop: target.offset().top-70
            }, 1000, 'swing', function () {
             $("a").blur();
            });
            return false;
          }
        }
      });
    });
    $(function() {
       $('table').not(".table-ok").addClass("table");
       $('table').not(".table-ok").addClass("table-bordered");
       // $('table').not(".table-ok").addClass("table-striped");
    });
    (function($, window, undefined) {
      // Add pretty print to all pre and code tags.
      $('pre, code').addClass("prettyprint");
      // Remove prettify from code tags inside pre tags.
      $('pre code').removeClass("prettyprint");
    })(jQuery, this);
    </script>
    <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-41419012-5', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>
